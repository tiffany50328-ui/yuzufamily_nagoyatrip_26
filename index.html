<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nagoya Trip 2026 âœˆï¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --kawaii-blue: #B9E5FB;
            --soft-blue: #E0F2FE;
            --deep-blue: #4A90E2;
            --accent-pink: #FFD1DC;
        }

        body {
            font-family: 'Zen Maru Gothic', 'Quicksand', sans-serif;
            background-color: #F8FDFF;
            color: #445566;
            padding-bottom: 80px; /* Space for bottom nav */
        }

        .kawaii-card {
            background: white;
            border-radius: 2rem;
            box-shadow: 0 10px 25px -5px rgba(185, 229, 251, 0.4);
            border: 2px solid white;
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; animation: slideUp 0.3s ease-out; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .nav-btn.active { color: var(--deep-blue); transform: scale(1.1); }
        .nav-btn.active i { color: var(--deep-blue); }

        .important-time {
            background: #FF8E8E;
            color: white;
            padding: 2px 8px;
            border-radius: 999px;
            font-weight: bold;
        }

        /* Timeline style */
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -17px;
            top: 5px;
            width: 12px;
            height: 12px;
            background: var(--kawaii-blue);
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 0 0 2px var(--kawaii-blue);
        }

        /* Hide scrollbar */
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="max-w-md mx-auto">

    <header class="p-6 text-center">
        <h1 class="text-2xl font-bold text-[#4A90E2] tracking-wide">åå¤å±‹ Â· æ…¶ç”Ÿæ—… ğŸ‚</h1>
        <p class="text-xs opacity-60 mt-1 uppercase tracking-widest">Nagoya Trip 2026</p>
    </header>

    <main class="px-5">
        
        <section id="plan" class="tab-content active">
            <div class="grid grid-cols-2 gap-3 mb-6">
                <div class="kawaii-card p-4 bg-blue-50/50">
                    <p class="text-[10px] font-bold opacity-50 mb-1 uppercase">Stay</p>
                    <p class="text-xs font-bold leading-tight">Garland Hotel</p>
                    <a href="https://maps.app.goo.gl/uX3L5Vp6YyR2" target="_blank" class="text-[10px] text-blue-500 underline mt-2 block">Google Map</a>
                </div>
                <div class="kawaii-card p-4 bg-pink-50/50">
                    <p class="text-[10px] font-bold opacity-50 mb-1 uppercase">Flight</p>
                    <p class="text-[10px] font-bold text-gray-600">å» CX530 11:30</p>
                    <p class="text-[10px] font-bold text-gray-600">å› CX531 16:40</p>
                </div>
            </div>

            <div id="itinerary-list" class="space-y-6">
                <div class="space-y-3">
                    <h3 class="font-bold text-lg flex items-center gap-2">
                        <span class="w-8 h-8 rounded-full bg-blue-400 text-white flex items-center justify-center text-sm shadow-sm">D1</span>
                        2/4 æŠµé”æ…¶ç”Ÿ
                    </h3>
                    <div class="kawaii-card p-5 ml-4 border-l-4 border-blue-200 space-y-4">
                        <div class="relative timeline-item pl-2 text-sm">
                            <span class="font-bold opacity-50 mr-2">15:30</span> æŠµé”ä¸­éƒ¨åœ‹éš›æ©Ÿå ´
                        </div>
                        <div class="relative timeline-item pl-2 text-sm font-bold">
                            <span class="important-time mr-2">17:30</span> é£¯åº— CHECK-IN
                        </div>
                        <div class="relative timeline-item pl-2 text-sm">
                            <span class="font-bold opacity-50 mr-2">17:30</span> Harbs ãƒ©ã‚·ãƒƒã‚¯åº—é ˜è›‹ç³• ğŸ°
                            <div class="flex gap-2 mt-1">
                                <a href="https://tabelog.com/aichi/A2301/A230103/23001221/" class="text-[10px] bg-blue-100 px-2 py-0.5 rounded-full text-blue-600">é£Ÿè¨˜å°è¦½</a>
                            </div>
                        </div>
                        <div class="relative timeline-item pl-2 text-sm">
                            <span class="font-bold text-pink-500 mr-2">20:00</span> é£¯åº—æŸšå­æ…¶ç”Ÿå¤§æœƒ ğŸ‰
                        </div>
                    </div>
                </div>

                <div class="space-y-3">
                    <h3 class="font-bold text-lg flex items-center gap-2">
                        <span class="w-8 h-8 rounded-full bg-blue-400 text-white flex items-center justify-center text-sm shadow-sm">D2</span>
                        2/5 ååŸèˆ‡é£›é©’ç‰›
                    </h3>
                    <div class="kawaii-card p-5 ml-4 border-l-4 border-blue-200 space-y-4">
                        <div class="relative timeline-item pl-2 text-sm">
                            <span class="font-bold opacity-50 mr-2">08:00</span> å–«èŒ¶Bon Bonæ—©é¤ â˜•
                        </div>
                        <div class="relative timeline-item pl-2 text-sm">
                            <span class="font-bold opacity-50 mr-2">09:30</span> åå¤å±‹åŸé‡‘é¯±å·¡ç¦®
                        </div>
                        <div class="relative timeline-item pl-2 text-sm">
                            <span class="important-time mr-2">11:30</span> é¦¬å–°ä¸€ä»£ é£›é©’ç‰›é¤ ğŸ‚
                            <div class="flex gap-2 mt-1">
                                <a href="https://maps.app.goo.gl/9ZpP7" class="text-[10px] bg-blue-100 px-2 py-0.5 rounded-full text-blue-600">åœ°åœ–</a>
                            </div>
                        </div>
                        <div class="relative timeline-item pl-2 text-sm">
                            <span class="font-bold opacity-50 mr-2">13:30</span> TOYOTAç”¢æ¥­ç´€å¿µé¤¨
                        </div>
                        <div class="relative timeline-item pl-2 text-sm">
                            <span class="font-bold opacity-50 mr-2">16:30</span> åå¤å±‹è»Šç«™å•†åœˆ (æ£’çƒé¸é…)
                        </div>
                    </div>
                </div>

                <div class="text-center opacity-30 text-xs italic">Scroll down for more</div>
            </div>
        </section>

        <section id="guide" class="tab-content">
            <div class="space-y-6 pb-6">
                <div class="kawaii-card overflow-hidden">
                    <div class="h-32 bg-[url('https://images.unsplash.com/photo-1590234900690-671239866297?auto=format&fit=crop&q=80&w=600')] bg-cover bg-center"></div>
                    <div class="p-5">
                        <h3 class="font-bold text-lg mb-2 text-blue-500">åå¤å±‹åŸ Nagoya Castle</h3>
                        <p class="text-xs leading-relaxed opacity-70">
                            å¾·å·å®¶åº·ä¸‹ä»¤å»ºé€ ï¼Œæ±Ÿæˆ¶å¹•åºœçš„é‡é®ã€‚å±‹é ‚ä¸Šçš„ã€Œé‡‘é¯±ã€æ˜¯åå¤å±‹çš„è±¡å¾µã€‚æœ¬ä¸¸å¾¡æ®¿çš„è¯éº—ç¹ªç•«æ›´æ˜¯å¿…çœ‹äº®é»ã€‚
                        </p>
                    </div>
                </div>

                <div class="kawaii-card overflow-hidden">
                    <div class="p-5">
                        <h3 class="font-bold text-lg mb-2 text-blue-500">éˆ´é¹¿è³½é“ Suzuka Circuit</h3>
                        <p class="text-xs leading-relaxed opacity-70 mb-4">
                            ä¸–ç•Œç´š F1 è³½é“ï¼Œä¹Ÿæ˜¯äº¤é€šå®‰å…¨çš„ä¸»é¡Œå…¬åœ’ã€‚é€™è£¡æœ‰å¤§äººå°å­©éƒ½èƒ½é§•é§›çš„éŠæ¨‚è¨­æ–½ï¼Œæ˜¯åå¤å±‹è¿‘éƒŠæœ€åˆºæ¿€çš„ä¸€ç«™ï¼
                        </p>
                        <div class="rounded-2xl overflow-hidden h-40 border-2 border-blue-50">
                            <iframe width="100%" height="100%" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://www.openstreetmap.org/export/embed.html?bbox=136.52%2C34.83%2C136.56%2C34.86&layer=mapnik"></iframe>
                        </div>
                    </div>
                </div>

                <div class="kawaii-card p-5">
                    <h3 class="font-bold text-lg mb-2 text-blue-500">åå¤å±‹æ°´æ—é¤¨</h3>
                    <p class="text-xs leading-relaxed opacity-70">
                        æ“æœ‰ä¸–ç•Œæœ€å¤§å‹çš„æˆ¶å¤–æ°´æ± ï¼Œå¯ä»¥çœ‹åˆ°è¶…å£¯è§€çš„æµ·è±šè¡¨æ¼”ã€‚é€™è£¡çš„åŒ—æ¥µé¤¨å’Œå—æ¥µæ¢æ¸¬èˆ¹ä¹Ÿæ˜¯ä¸å¯éŒ¯éçš„ç‰¹è‰²æ™¯é»ã€‚
                    </p>
                </div>
            </div>
        </section>

        <section id="wallet" class="tab-content">
            <div class="kawaii-card p-5 mb-6 bg-blue-50/50">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-sm">åŒ¯ç‡æ›ç®— (è‡ªè¨‚åŒ¯ç‡: 0.21)</h3>
                    <input id="exchange-rate" type="number" step="0.001" value="0.21" class="w-16 p-1 text-xs rounded-lg border-none bg-white text-center">
                </div>
                <input id="calc-input" type="text" placeholder="è¼¸å…¥ç®—å¼ å¦‚: 500+1200*2" class="w-full p-3 rounded-2xl border-none shadow-inner mb-3 text-lg font-bold text-blue-600 focus:outline-none">
                <div class="flex justify-between items-end px-2">
                    <span id="calc-result" class="text-xs opacity-50">NT$ 0</span>
                    <button onclick="calculate()" class="bg-blue-400 text-white px-6 py-2 rounded-xl shadow-md font-bold text-sm active:scale-95 transition-transform">è¨ˆç®— / =</button>
                </div>
            </div>

            <div class="kawaii-card p-5 mb-6">
                <div class="space-y-4">
                    <div class="flex gap-2">
                        <input id="exp-name" type="text" placeholder="å“é …åç¨±" class="flex-1 p-2 bg-gray-50 rounded-xl text-sm border-none focus:ring-1 focus:ring-blue-200">
                        <input id="exp-jpy" type="number" placeholder="æ—¥å¹£ Â¥" class="w-24 p-2 bg-gray-50 rounded-xl text-sm border-none">
                    </div>
                    <div class="flex items-center gap-3">
                        <label class="flex-1 flex items-center justify-center gap-2 p-2 bg-blue-50 text-blue-500 rounded-xl text-xs cursor-pointer active:bg-blue-100">
                            <i class="fas fa-camera"></i> æ‹ç…§/ä¸Šå‚³ç…§ç‰‡
                            <input type="file" accept="image/*" class="hidden" onchange="processImage(this)">
                        </label>
                        <button onclick="saveExpense()" class="bg-blue-400 text-white w-12 h-10 rounded-xl flex items-center justify-center"><i class="fas fa-plus"></i></button>
                    </div>
                    <div id="img-preview-container" class="hidden relative inline-block">
                        <img id="img-preview" src="" class="w-16 h-16 rounded-lg object-cover">
                        <button onclick="clearImage()" class="absolute -top-2 -right-2 bg-red-400 text-white rounded-full w-5 h-5 text-[10px]">âœ•</button>
                    </div>
                </div>
            </div>

            <div id="expense-list" class="space-y-3">
                </div>
        </section>

        <section id="lists" class="tab-content">
            <div class="kawaii-card p-6 mb-6">
                <h3 class="font-bold mb-4 flex items-center gap-2 text-blue-500">
                    <i class="fas fa-check-square"></i> è¡Œå‰æº–å‚™
                </h3>
                <div id="prep-list" class="space-y-3">
                    </div>
            </div>

            <div class="kawaii-card p-6">
                <h3 class="font-bold mb-4 flex items-center gap-2 text-blue-500">
                    <i class="fas fa-sticky-note"></i> å€‹äººå‚™å¿˜éŒ„
                </h3>
                <textarea id="memo-input" rows="5" class="w-full p-4 bg-gray-50 rounded-2xl text-sm border-none focus:ring-1 focus:ring-blue-200 mb-3" placeholder="è²¼ä¸Šç¶²å€æˆ–ç´€éŒ„äº‹é …..."></textarea>
                <div id="memo-links" class="flex flex-wrap gap-2 mb-4"></div>
                <button onclick="saveMemo()" class="w-full bg-blue-400 text-white py-3 rounded-2xl font-bold active:scale-95 transition-transform shadow-md">å„²å­˜å‚™å¿˜éŒ„</button>
            </div>
        </section>

        <section id="info" class="tab-content">
            <div class="space-y-4">
                <div class="kawaii-card p-5">
                    <h4 class="font-bold text-blue-500 mb-3 underline decoration-wavy">â›… å¤©æ°£é å ±</h4>
                    <a href="https://www.jma.go.jp/bosai/forecast/#area_code=230000" target="_blank" class="block bg-blue-50 p-3 rounded-xl text-xs text-blue-600 font-bold">é–‹å•Ÿæ—¥æœ¬æ°£è±¡å»³ (æ„›çŸ¥ç¸£) <i class="fas fa-external-link-alt ml-1"></i></a>
                </div>

                <div class="kawaii-card p-5 bg-red-50/30">
                    <h4 class="font-bold text-red-500 mb-3">ğŸ†˜ ç·Šæ€¥è¯çµ¡</h4>
                    <ul class="text-[11px] space-y-2 opacity-80 leading-relaxed">
                        <li><b>è­¦å¯Ÿå±€ï¼š</b>110 / <b>æ•‘è­·è»Šï¼š</b>119</li>
                        <li><b>å°åŒ—é§å¤§é˜ªç¶“æ¿Ÿæ–‡åŒ–è¾¦äº‹è™•ï¼š</b>+81-6-6443-8481</li>
                        <li><b>åœ°å€ï¼š</b>åå¤å±‹å¸‚ä¸­å€æ¦®3-9-6 (Hotel)</li>
                    </ul>
                </div>

                <div class="kawaii-card p-5">
                    <h4 class="font-bold text-blue-500 mb-3 italic">âš ï¸ æ—…éŠé ˆçŸ¥</h4>
                    <ul class="text-[11px] list-disc list-inside space-y-1 opacity-70">
                        <li>è‚‰è£½å“ã€ç«è…¿ã€æ°´æœåš´ç¦æ”œå¸¶å‡ºå…¥å¢ƒã€‚</li>
                        <li>æ—¥æœ¬å®¤å…§å…¨é¢ç¦è¸ï¼Œè«‹æ‰¾æŒ‡å®šå¸è¸å€ã€‚</li>
                        <li>æ­é›»æ¢¯åœ¨åå¤å±‹é€šå¸¸ç¿’æ…£é å³ç«™ (è·Ÿå¤§é˜ªé¡ä¼¼)ã€‚</li>
                        <li>åƒåœ¾è«‹ç¢ºå¯¦åˆ†é¡ã€‚</li>
                    </ul>
                </div>
            </div>
        </section>

    </main>

    <nav class="fixed bottom-4 left-4 right-4 h-16 bg-white/90 backdrop-blur-md rounded-[2rem] shadow-2xl flex justify-around items-center px-2 z-50 border border-white/50">
        <button onclick="switchTab('plan', this)" class="nav-btn active flex flex-col items-center text-gray-400 transition-all">
            <i class="fas fa-calendar-alt text-lg"></i><span class="text-[9px] font-bold mt-1 uppercase">Plan</span>
        </button>
        <button onclick="switchTab('guide', this)" class="nav-btn flex flex-col items-center text-gray-400 transition-all">
            <i class="fas fa-compass text-lg"></i><span class="text-[9px] font-bold mt-1 uppercase">Guide</span>
        </button>
        <button onclick="switchTab('wallet', this)" class="nav-btn flex flex-col items-center text-gray-400 transition-all">
            <i class="fas fa-wallet text-lg"></i><span class="text-[9px] font-bold mt-1 uppercase">Wallet</span>
        </button>
        <button onclick="switchTab('lists', this)" class="nav-btn flex flex-col items-center text-gray-400 transition-all">
            <i class="fas fa-clipboard-list text-lg"></i><span class="text-[9px] font-bold mt-1 uppercase">Lists</span>
        </button>
        <button onclick="switchTab('info', this)" class="nav-btn flex flex-col items-center text-gray-400 transition-all">
            <i class="fas fa-info-circle text-lg"></i><span class="text-[9px] font-bold mt-1 uppercase">Info</span>
        </button>
    </nav>

    <script>
        // --- æ ¸å¿ƒç‹€æ…‹ç®¡ç† ---
        let state = {
            expenses: JSON.parse(localStorage.getItem('nagoya_expenses') || '[]'),
            preps: JSON.parse(localStorage.getItem('nagoya_preps') || '[{"t":"è­·ç…§","c":false},{"t":"SIMå¡/ç¶²å¡","c":false},{"t":"æ—¥å¹£ç¾é‡‘","c":false},{"t":"è¡Œå‹•é›»æº","c":false}]'),
            memo: localStorage.getItem('nagoya_memo') || "",
            tempImg: ""
        };

        // --- åˆå§‹åŒ–è¡Œç¨‹ (D3-D5 è£œå®Œ) ---
        const extraItinerary = `
            <div class="space-y-3">
                <h3 class="font-bold text-lg flex items-center gap-2">
                    <span class="w-8 h-8 rounded-full bg-blue-400 text-white flex items-center justify-center text-sm shadow-sm">D3</span>
                    2/6 æ°´æ—é¤¨å¤§é ˆ
                </h3>
                <div class="kawaii-card p-5 ml-4 border-l-4 border-blue-200 space-y-4 text-sm">
                    <div><span class="font-bold opacity-50 mr-2">08:00</span> Konparuæ¦®è¥¿åƒæ—©é¤</div>
                    <div><span class="font-bold opacity-50 mr-2">09:30</span> åå¤å±‹æ°´æ—é¤¨ã€å—æ¥µæ¢æ¸¬èˆ¹</div>
                    <div><span class="font-bold opacity-50 mr-2">14:30</span> å¤§é ˆ & æ¦®å•†åœˆ (é¸é…ç«¶é¦¬å ´)</div>
                </div>
            </div>
            <div class="space-y-3">
                <h3 class="font-bold text-lg flex items-center gap-2">
                    <span class="w-8 h-8 rounded-full bg-blue-400 text-white flex items-center justify-center text-sm shadow-sm">D4</span>
                    2/7 éˆ´é¹¿è³½è»Š
                </h3>
                <div class="kawaii-card p-5 ml-4 border-l-4 border-blue-200 space-y-4 text-sm">
                    <div><span class="font-bold opacity-50 mr-2">æ•´æ—¥</span> éˆ´é¹¿è³½é“ä¸€æ—¥éŠ ğŸï¸</div>
                    <div><span class="font-bold opacity-50 mr-2">æ™šä¸Š</span> åå¤å±‹è»Šç«™å•†åœˆ</div>
                </div>
            </div>
            <div class="space-y-3">
                <h3 class="font-bold text-lg flex items-center gap-2">
                    <span class="w-8 h-8 rounded-full bg-blue-400 text-white flex items-center justify-center text-sm shadow-sm">D5</span>
                    2/8 è³¦æ­¸
                </h3>
                <div class="kawaii-card p-5 ml-4 border-l-4 border-blue-200 space-y-4 text-sm">
                    <div><span class="font-bold opacity-50 mr-2">09:00</span> KOMEDAåƒæ—©é¤</div>
                    <div><span class="font-bold opacity-50 mr-2">10:30</span> ç†±ç”°ç¥å®® â›©ï¸</div>
                    <div><span class="important-time mr-2">14:30</span> æŠµé”ä¸­éƒ¨åœ‹éš›æ©Ÿå ´</div>
                    <div><span class="font-bold opacity-50 mr-2">16:40</span> èˆªç­ CX531 èµ·é£›</div>
                </div>
            </div>
        `;
        document.getElementById('itinerary-list').innerHTML += extraItinerary;

        // --- åˆ†é åˆ‡æ› ---
        function switchTab(tabId, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
            window.scrollTo(0, 0);
        }

        // --- è¨ˆç®—æ©Ÿ ---
        function calculate() {
            const input = document.getElementById('calc-input');
            const rate = parseFloat(document.getElementById('exchange-rate').value) || 0.21;
            try {
                // å®‰å…¨ eval æ›¿ä»£
                const result = Function('"use strict";return (' + input.value.replace(/[^-()\d/*+.]/g, '') + ')')();
                input.value = result;
                document.getElementById('calc-result').innerText = `â‰ˆ NT$ ${Math.round(result * rate).toLocaleString()}`;
            } catch (e) {
                alert("è¨ˆç®—å¼æœ‰èª¤å”·ï¼");
            }
        }

        // --- è¨˜å¸³åŠŸèƒ½ ---
        function processImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        // å£“ç¸®åœ–ç‰‡ï¼šé•·å¯¬æœ€å¤§ 400px
                        let width = img.width;
                        let height = img.height;
                        if (width > height) {
                            if (width > 400) { height *= 400 / width; width = 400; }
                        } else {
                            if (height > 400) { width *= 400 / height; height = 400; }
                        }
                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);
                        state.tempImg = canvas.toDataURL('image/jpeg', 0.7);
                        document.getElementById('img-preview').src = state.tempImg;
                        document.getElementById('img-preview-container').classList.remove('hidden');
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function clearImage() {
            state.tempImg = "";
            document.getElementById('img-preview-container').classList.add('hidden');
        }

        function saveExpense() {
            const name = document.getElementById('exp-name').value;
            const jpy = document.getElementById('exp-jpy').value;
            const rate = parseFloat(document.getElementById('exchange-rate').value) || 0.21;
            if (!name || !jpy) return alert("è«‹å¡«ä¸Šå“é …è·Ÿé‡‘é¡ï½");

            const newExp = {
                id: Date.now(),
                name,
                jpy: parseFloat(jpy),
                twd: Math.round(jpy * rate),
                img: state.tempImg
            };

            state.expenses.unshift(newExp);
            localStorage.setItem('nagoya_expenses', JSON.stringify(state.expenses));
            renderExpenses();
            
            // é‡ç½®
            document.getElementById('exp-name').value = "";
            document.getElementById('exp-jpy').value = "";
            clearImage();
        }

        function renderExpenses() {
            const container = document.getElementById('expense-list');
            container.innerHTML = state.expenses.map(e => `
                <div class="kawaii-card p-3 flex items-center gap-3">
                    ${e.img ? `<img src="${e.img}" class="w-12 h-12 rounded-xl object-cover">` : `<div class="w-12 h-12 bg-gray-100 rounded-xl flex items-center justify-center text-[10px] text-gray-400">NO IMG</div>`}
                    <div class="flex-1">
                        <p class="text-xs font-bold">${e.name}</p>
                        <p class="text-[10px] opacity-50">Â¥${e.jpy.toLocaleString()} / NT$${e.twd.toLocaleString()}</p>
                    </div>
                    <button onclick="deleteExpense(${e.id})" class="text-gray-300 active:text-red-300 p-2"><i class="fas fa-trash"></i></button>
                </div>
            `).join('');
        }

        function deleteExpense(id) {
            state.expenses = state.expenses.filter(e => e.id !== id);
            localStorage.setItem('nagoya_expenses', JSON.stringify(state.expenses));
            renderExpenses();
        }

        // --- æ¸…å–®åŠŸèƒ½ ---
        function renderPreps() {
            const container = document.getElementById('prep-list');
            container.innerHTML = state.preps.map((p, i) => `
                <div class="flex items-center gap-3 text-sm">
                    <input type="checkbox" ${p.c ? 'checked' : ''} onchange="togglePrep(${i})" class="w-5 h-5 accent-blue-400 rounded-full border-gray-200">
                    <span class="${p.c ? 'line-through opacity-30 italic' : ''}">${p.t}</span>
                </div>
            `).join('');
        }

        function togglePrep(i) {
            state.preps[i].c = !state.preps[i].c;
            localStorage.setItem('nagoya_preps', JSON.stringify(state.preps));
            renderPreps();
        }

        // --- å‚™å¿˜éŒ„ ---
        function saveMemo() {
            const val = document.getElementById('memo-input').value;
            state.memo = val;
            localStorage.setItem('nagoya_memo', val);
            detectLinks(val);
            alert("å‚™å¿˜éŒ„å·²åŒæ­¥ï¼");
        }

        function detectLinks(text) {
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            const container = document.getElementById('memo-links');
            const links = text.match(urlRegex) || [];
            container.innerHTML = links.map(url => `
                <a href="${url}" target="_blank" class="bg-blue-100 text-blue-500 text-[10px] px-3 py-1 rounded-full flex items-center gap-1 max-w-[150px] truncate">
                    <i class="fas fa-link"></i> ${url}
                </a>
            `).join('');
        }

        // --- åˆå§‹åŒ–é é¢ ---
        renderExpenses();
        renderPreps();
        document.getElementById('memo-input').value = state.memo;
        detectLinks(state.memo);
    </script>
</body>
</html>

